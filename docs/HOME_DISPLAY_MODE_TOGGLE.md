# ホームページ表示切り替え機能 実装ドキュメント

## 概要

ユーザーがホームページの表示方式（カード式/ダイアル式）を手動で選択できる機能を実装しました。

## 実装内容

### 1. 表示モード

以下の3つの表示モードを用意：

- **自動切り替え** (`auto`): デバイスの画面幅に応じて自動的にカード式/ダイアル式を切り替え（従来の動作）
- **カード表示** (`card`): 常にカード式で表示
- **ダイアル表示** (`dial`): 常にダイアル式で表示

### 2. UI変更点

#### デスクトップ表示
- ページ右上に表示モード切り替えセグメントコントロールと設定ボタンを配置
- セグメントコントロールで「自動」「カード」「ダイアル」を選択可能
- 設定ボタンで現在の表示モードに応じた設定モーダルを開く

#### モバイル表示
- コンパクトなアイコンボタンで表示
- 表示モード切り替えボタン（カード⇔ダイアル）
- 設定ボタン

### 3. 動作仕様

#### モード切り替え時の挙動
1. ユーザーが表示モードを変更すると、即座に表示が切り替わる
2. モードを「カード」または「ダイアル」に切り替えた際、対応する設定モーダルが自動的に開く
   - カード表示に切り替え → カード設定モーダルを表示
   - ダイアル表示に切り替え → ダイアル設定モーダルを表示
3. 設定はLocalStorageに保存され、次回訪問時も適用される

#### 設定ボタンの挙動
- 設定ボタンをクリックすると、現在の表示状態に応じた設定モーダルを開く
  - カード表示中 → カード設定モーダル
  - ダイアル表示中 → ダイアル設定モーダル

### 4. 技術的な実装

#### 新規追加ファイル
- `frontend/src/components/dashboard/DisplayModeToggle.tsx`
  - 表示モード切り替えUIコンポーネント
  - デスクトップ/モバイル両対応

#### 変更ファイル
- `frontend/src/lib/storage/dashboard-settings.ts`
  - `HomeDisplayMode` 型を追加
  - `loadHomeDisplayMode()`, `saveHomeDisplayMode()` 関数を追加
  - LocalStorageキー: `home_display_mode`

- `frontend/src/app/page.tsx`
  - `displayMode` ステート管理を追加
  - `DisplayModeToggle` コンポーネントを統合
  - モード切り替えハンドラーと設定モーダル連携を実装

### 5. UX改善点

1. **ユーザーの選択を尊重**: 自動切り替えに頼らず、ユーザーが好みの表示方式を選択可能
2. **設定へのスムーズな導線**: モード切り替え時に自動的に設定モーダルを開くことで、初めてのユーザーでも迷わず設定可能
3. **永続化**: LocalStorageに保存することで、次回訪問時も設定を維持
4. **レスポンシブ対応**: モバイルではコンパクトなボタン表示に自動切り替え

## 使用方法

### ユーザー操作

1. **表示モードの選択**
   - デスクトップ: ページ右上のセグメントコントロールで「自動」「カード」「ダイアル」を選択
   - モバイル: 右上のアイコンボタンをタップしてカード⇔ダイアルを切り替え

2. **設定のカスタマイズ**
   - 設定ボタン（歯車アイコン）をクリック
   - 現在の表示モードに応じた設定モーダルが開く
   - カード/ダイアルの表示内容や順序を調整

3. **デフォルトに戻す**
   - セグメントコントロールで「自動」を選択
   - デバイスの画面幅に応じた自動切り替えに戻る

## テスト項目

- [x] TypeScript型チェック合格
- [x] ESLint合格
- [x] ビルド成功
- [ ] 実機での動作確認（要DB/バックエンド起動）
  - [ ] デスクトップでの表示モード切り替え
  - [ ] モバイルでの表示モード切り替え
  - [ ] LocalStorageへの設定保存
  - [ ] 設定モーダルの連携動作
