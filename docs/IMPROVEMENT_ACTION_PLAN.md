# MyCats Pro - æ”¹å–„å®Ÿè£…ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

**ä½œæˆæ—¥:** 2025-11-11  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:** MyCats Pro (çŒ«ç”Ÿä½“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ )  
**ç›®çš„:** ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç‰¹å®šã•ã‚ŒãŸæ”¹å–„é …ç›®ã®å…·ä½“çš„ãªå®Ÿè£…è¨ˆç”»

---

## ğŸ“‹ ç›®æ¬¡

1. [å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§](#å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§)
2. [ãƒ•ã‚§ãƒ¼ã‚º1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–](#ãƒ•ã‚§ãƒ¼ã‚º1-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–)
3. [ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–](#ãƒ•ã‚§ãƒ¼ã‚º2-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–)
4. [ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹å–„](#ãƒ•ã‚§ãƒ¼ã‚º3-ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹å–„)
5. [ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#ãƒ•ã‚§ãƒ¼ã‚º4-ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
6. [å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## å„ªå…ˆåº¦åˆ¥ã‚¿ã‚¹ã‚¯ä¸€è¦§

### ğŸ”´ CRITICAL - å³æ™‚å¯¾å¿œ (1-2é€±é–“)

| # | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | æ‹…å½“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|--------|----------|------|-----------|
| C1 | CSRFä¿è­·ã®å®Ÿè£… | 4h | Backend | â³ æœªç€æ‰‹ |
| C2 | ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç† | 8h | DevOps | â³ æœªç€æ‰‹ |

### ğŸŸ  HIGH - é«˜å„ªå…ˆåº¦ (2-4é€±é–“)

| # | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | æ‹…å½“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|--------|----------|------|-----------|
| H1 | APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å¼·åŒ– | 4h | Backend | â³ æœªç€æ‰‹ |
| H2 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ– | 4h | Backend | â³ æœªç€æ‰‹ |
| H3 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®‰å…¨æ€§å¼·åŒ– | 16h | Frontend | â³ æœªç€æ‰‹ |

### ğŸŸ¡ MEDIUM - ä¸­å„ªå…ˆåº¦ (1-3ãƒ¶æœˆ)

| # | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | æ‹…å½“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|--------|----------|------|-----------|
| M1 | ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ | 32h | Frontend | â³ æœªç€æ‰‹ |
| M2 | ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š | 64h | All | â³ æœªç€æ‰‹ |
| M3 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– | 32h | All | â³ æœªç€æ‰‹ |

### ğŸŸ¢ LOW - ä½å„ªå…ˆåº¦ (3-6ãƒ¶æœˆ)

| # | ã‚¿ã‚¹ã‚¯ | æ‰€è¦æ™‚é–“ | æ‹…å½“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|---|--------|----------|------|-----------|
| L1 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ‹¡å…… | 16h | All | â³ æœªç€æ‰‹ |
| L2 | ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°å¼·åŒ– | 16h | DevOps | â³ æœªç€æ‰‹ |

---

## ãƒ•ã‚§ãƒ¼ã‚º1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

### C1: CSRFä¿è­·ã®å®Ÿè£…

**ç›®çš„:** ã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªæ”»æ’ƒã‹ã‚‰ã®ä¿è­·

**å®Ÿè£…æ‰‹é †:**

#### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: CSRF ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ

```bash
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd backend
pnpm add csurf @types/csurf
```

```typescript
// backend/src/main.ts
import * as csurf from 'csurf';
import * as cookieParser from 'cookie-parser';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  
  // Cookie parserã¯æ—¢ã«è¨­å®šæ¸ˆã¿
  app.use(cookieParser());
  
  // CSRFä¿è­·ã‚’è¿½åŠ 
  app.use(csurf({ 
    cookie: {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      sameSite: 'strict',
    }
  }));
  
  // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  app.getHttpAdapter().get('/api/v1/csrf-token', (req: any, res: any) => {
    res.json({ csrfToken: req.csrfToken() });
  });
}
```

#### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã¨é€ä¿¡

```typescript
// frontend/src/lib/api/csrf.ts
let csrfToken: string | null = null;

export async function getCsrfToken(): Promise<string> {
  if (csrfToken) return csrfToken;
  
  const response = await fetch(`${API_BASE_URL}/csrf-token`, {
    credentials: 'include',
  });
  const data = await response.json();
  csrfToken = data.csrfToken;
  return csrfToken;
}

export function clearCsrfToken(): void {
  csrfToken = null;
}
```

```typescript
// frontend/src/lib/api/client.ts
async function request<T>(
  path: string,
  options: RequestInit = {}
): Promise<T> {
  const headers = new Headers(options.headers);
  
  // POST, PUT, DELETE ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ 
  if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(options.method || '')) {
    const token = await getCsrfToken();
    headers.set('X-CSRF-Token', token);
  }
  
  const response = await fetch(`${API_BASE_URL}${path}`, {
    ...options,
    headers,
    credentials: 'include',
  });
  
  return response.json();
}
```

#### 3. ãƒ†ã‚¹ãƒˆ

```typescript
// backend/test/csrf.e2e-spec.ts
describe('CSRF Protection (e2e)', () => {
  it('should reject POST request without CSRF token', async () => {
    return request(app.getHttpServer())
      .post('/api/v1/cats')
      .send({ name: 'Test Cat' })
      .expect(403);
  });
  
  it('should accept POST request with valid CSRF token', async () => {
    const csrfRes = await request(app.getHttpServer())
      .get('/api/v1/csrf-token')
      .expect(200);
    
    const csrfToken = csrfRes.body.csrfToken;
    
    return request(app.getHttpServer())
      .post('/api/v1/cats')
      .set('X-CSRF-Token', csrfToken)
      .send({ name: 'Test Cat' })
      .expect(201);
  });
});
```

**å®Œäº†åŸºæº–:**
- [ ] CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…
- [ ] ã™ã¹ã¦ã®POST/PUT/DELETE ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•ä»˜ä¸
- [ ] E2Eãƒ†ã‚¹ãƒˆã®è¿½åŠ 
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

### C2: ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç†

**ç›®çš„:** æ©Ÿå¯†æƒ…å ±ã®å®‰å…¨ãªç®¡ç†ã¨èª¤ã£ãŸå…¬é–‹ã®é˜²æ­¢

**å®Ÿè£…æ‰‹é †:**

#### 1. ç’°å¢ƒå¤‰æ•°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å¼·åŒ–

```typescript
// backend/src/common/config/env.validation.ts
import { z } from 'zod';

const envSchema = z.object({
  // Database
  DATABASE_URL: z.string().url(),
  
  // JWT
  JWT_SECRET: z.string().min(32),
  JWT_REFRESH_SECRET: z.string().min(32),
  JWT_EXPIRES_IN: z.string().default('15m'),
  JWT_REFRESH_EXPIRES_IN: z.string().default('7d'),
  
  // Server
  NODE_ENV: z.enum(['development', 'production', 'test']),
  PORT: z.coerce.number().min(1000).max(65535),
  CORS_ORIGIN: z.string().min(1).when('NODE_ENV', {
    is: 'production',
    then: z.string().min(1),
  }),
  
  // Security
  ARGON2_MEMORY_COST: z.coerce.number().default(65536),
  ARGON2_TIME_COST: z.coerce.number().default(3),
  ARGON2_PARALLELISM: z.coerce.number().default(4),
  
  // Rate Limiting
  THROTTLE_TTL: z.coerce.number().default(60000),
  THROTTLE_LIMIT: z.coerce.number().default(100),
});

export type Environment = z.infer<typeof envSchema>;

export function validateEnv(): Environment {
  try {
    return envSchema.parse(process.env);
  } catch (error) {
    if (error instanceof z.ZodError) {
      console.error('âŒ Environment validation failed:');
      error.errors.forEach(err => {
        console.error(`  - ${err.path.join('.')}: ${err.message}`);
      });
      throw new Error('Invalid environment configuration');
    }
    throw error;
  }
}
```

#### 2. .env.example ã®æœ€å°åŒ–

```bash
# .env.example (æœ¬ç•ªç’°å¢ƒç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰ã€å®Ÿéš›ã®å€¤ã¯å«ã‚ãªã„
# å„è‡ªã§å®‰å…¨ã«ç”Ÿæˆãƒ»è¨­å®šã™ã‚‹ã“ã¨

# Database
DATABASE_URL="postgresql://user:password@host:port/dbname"

# JWT (32æ–‡å­—ä»¥ä¸Šã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã‚’ç”Ÿæˆã—ã¦è¨­å®š)
JWT_SECRET="<generate-random-32-char-string>"
JWT_REFRESH_SECRET="<generate-random-32-char-string>"

# Server
NODE_ENV="production"
PORT=3004
CORS_ORIGIN="https://your-domain.com"
```

#### 3. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```typescript
// scripts/generate-secrets.ts
import { randomBytes } from 'crypto';

function generateSecret(length: number = 32): string {
  return randomBytes(length).toString('base64');
}

console.log('Generated secrets for .env file:\n');
console.log(`JWT_SECRET="${generateSecret()}"`);
console.log(`JWT_REFRESH_SECRET="${generateSecret()}"`);
console.log('\nâš ï¸  Store these values securely and never commit to Git!');
```

#### 4. .gitignore ã®ç¢ºèª

```bash
# .gitignore
.env
.env.local
.env.*.local
.env.production
.env.development

# Keep only .env.example
!.env.example
```

**å®Œäº†åŸºæº–:**
- [ ] Zodã«ã‚ˆã‚‹ç’°å¢ƒå¤‰æ•°ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] .env.example ã®æœ€å°åŒ–
- [ ] ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ
- [ ] .gitignore ã®ç¢ºèªãƒ»æ›´æ–°
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆSETUP_GUIDE.mdï¼‰ã®æ›´æ–°

---

### H1: APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å¼·åŒ–

**ç›®çš„:** DDoSæ”»æ’ƒã¨ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‹ã‚‰ã®ä¿è­·

**å®Ÿè£…æ‰‹é †:**

#### 1. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è¨­å®š

```typescript
// backend/src/common/guards/rate-limit.config.ts
export const RateLimitConfig = {
  // èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: å³æ ¼ãªåˆ¶é™
  auth: {
    login: { ttl: 60000, limit: 3 },      // 1åˆ†é–“ã«3å›
    register: { ttl: 300000, limit: 5 },   // 5åˆ†é–“ã«5å›
    resetPassword: { ttl: 300000, limit: 3 }, // 5åˆ†é–“ã«3å›
  },
  
  // API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: é€šå¸¸ã®åˆ¶é™
  api: {
    read: { ttl: 60000, limit: 100 },     // 1åˆ†é–“ã«100å›ï¼ˆGETï¼‰
    write: { ttl: 60000, limit: 30 },     // 1åˆ†é–“ã«30å›ï¼ˆPOST/PUT/DELETEï¼‰
  },
  
  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰: å³æ ¼ãªåˆ¶é™
  upload: {
    ttl: 300000, limit: 10,               // 5åˆ†é–“ã«10å›
  },
};
```

#### 2. ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿

```typescript
// backend/src/common/decorators/rate-limit.decorator.ts
import { SetMetadata } from '@nestjs/common';

export const RATE_LIMIT_KEY = 'rate_limit';

export interface RateLimitOptions {
  ttl: number;
  limit: number;
}

export const RateLimit = (options: RateLimitOptions) =>
  SetMetadata(RATE_LIMIT_KEY, options);
```

#### 3. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¸ã®é©ç”¨

```typescript
// backend/src/auth/auth.controller.ts
import { RateLimit } from '../common/decorators/rate-limit.decorator';
import { RateLimitConfig } from '../common/guards/rate-limit.config';

@Controller('auth')
export class AuthController {
  @Post('login')
  @RateLimit(RateLimitConfig.auth.login)
  async login(@Body() dto: LoginDto) {
    return this.authService.login(dto);
  }
  
  @Post('register')
  @RateLimit(RateLimitConfig.auth.register)
  async register(@Body() dto: RegisterDto) {
    return this.authService.register(dto);
  }
}
```

#### 4. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…

```typescript
// backend/src/common/guards/enhanced-throttler.guard.ts
import { ExecutionContext, Injectable } from '@nestjs/common';
import { ThrottlerGuard } from '@nestjs/throttler';
import { Reflector } from '@nestjs/core';
import { RATE_LIMIT_KEY, RateLimitOptions } from '../decorators/rate-limit.decorator';

@Injectable()
export class EnhancedThrottlerGuard extends ThrottlerGuard {
  constructor(
    protected readonly options: any,
    protected readonly storageService: any,
    protected readonly reflector: Reflector,
  ) {
    super(options, storageService, reflector);
  }

  protected async getTracker(req: Record<string, any>): Promise<string> {
    // IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’çµ„ã¿åˆã‚ã›ã¦ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
    const ip = req.ip || req.connection.remoteAddress;
    const userId = req.user?.id || 'anonymous';
    return `${ip}-${userId}`;
  }

  protected async shouldSkip(context: ExecutionContext): Promise<boolean> {
    // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯é™¤å¤–
    const request = context.switchToHttp().getRequest();
    return request.url === '/health';
  }
}
```

**å®Œäº†åŸºæº–:**
- [ ] ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¨­å®šã®å®šç¾©
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ã®å®Ÿè£…
- [ ] å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®é©ç”¨
- [ ] æ‹¡å¼µThrottlerã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…éæ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ”¹å–„
- [ ] ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

---

## ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

### H2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–

**ç›®çš„:** ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Šã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®çŸ­ç¸®

**å®Ÿè£…æ‰‹é †:**

#### 1. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ã®å®šç¾©

```prisma
// backend/prisma/schema.prisma

// çŒ«ãƒ†ãƒ¼ãƒ–ãƒ«: æ¤œç´¢é »åº¦ã®é«˜ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
model Cat {
  id        String   @id @default(uuid())
  name      String
  birthDate DateTime @map("birth_date")
  gender    String
  breedId   String   @map("breed_id")
  ownerId   String?  @map("owner_id")
  deletedAt DateTime? @map("deleted_at")
  
  // ã‚·ãƒ³ã‚°ãƒ«ã‚«ãƒ©ãƒ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([name])           // åå‰æ¤œç´¢
  @@index([birthDate])      // èª•ç”Ÿæ—¥æ¤œç´¢
  @@index([gender])         // æ€§åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  @@index([deletedAt])      // ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  
  // è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([breedId, name])  // å“ç¨®åˆ¥åå‰æ¤œç´¢
  @@index([ownerId, deletedAt]) // ã‚ªãƒ¼ãƒŠãƒ¼åˆ¥ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŒ«
  
  @@map("cats")
}

// è¡€çµ±ãƒ†ãƒ¼ãƒ–ãƒ«: ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¤œç´¢ã®æœ€é©åŒ–
model Pedigree {
  id               String   @id @default(uuid())
  pedigreeId       String   @unique @map("pedigree_id")
  catName          String   @map("cat_name")
  fatherPedigreeId String?  @map("father_pedigree_id")
  motherPedigreeId String?  @map("mother_pedigree_id")
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  @@index([fatherPedigreeId])
  @@index([motherPedigreeId])
  @@index([catName])
  
  @@map("pedigrees")
}

// äº¤é…è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«
model BreedingRecord {
  id           String   @id @default(uuid())
  maleId       String   @map("male_id")
  femaleId     String   @map("female_id")
  breedingDate DateTime @map("breeding_date")
  status       String
  
  @@index([maleId])
  @@index([femaleId])
  @@index([breedingDate])
  @@index([status])
  @@index([maleId, femaleId, breedingDate]) // è¤‡åˆæ¤œç´¢
  
  @@map("breeding_records")
}

// ã‚±ã‚¢è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«
model CareRecord {
  id       String   @id @default(uuid())
  catId    String   @map("cat_id")
  careType String   @map("care_type")
  careDate DateTime @map("care_date")
  
  @@index([catId])
  @@index([careType])
  @@index([careDate])
  @@index([catId, careDate]) // çŒ«åˆ¥ã®æ™‚ç³»åˆ—æ¤œç´¢
  
  @@map("care_records")
}

// ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
model Schedule {
  id           String   @id @default(uuid())
  catId        String?  @map("cat_id")
  scheduleDate DateTime @map("schedule_date")
  type         String
  status       String
  
  @@index([scheduleDate])
  @@index([type])
  @@index([status])
  @@index([catId, scheduleDate]) // çŒ«åˆ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  
  @@map("schedules")
}
```

#### 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã¨é©ç”¨

```bash
# é–‹ç™ºç’°å¢ƒ
cd backend
pnpm prisma migrate dev --name add_performance_indexes

# æœ¬ç•ªç’°å¢ƒï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ãƒ†ã‚¹ãƒˆï¼‰
pnpm prisma migrate deploy
```

#### 3. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ¤œè¨¼

```sql
-- PostgreSQLã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
-- backend/prisma/seed/verify-indexes.sql

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸€è¦§
SELECT
  schemaname,
  tablename,
  indexname,
  indexdef
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY tablename, indexname;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çµ±è¨ˆ
SELECT
  schemaname,
  tablename,
  indexname,
  idx_scan as index_scans,
  idx_tup_read as tuples_read,
  idx_tup_fetch as tuples_fetched
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;

-- æœªä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ¤œå‡º
SELECT
  schemaname,
  tablename,
  indexname
FROM pg_stat_user_indexes
WHERE idx_scan = 0
  AND schemaname = 'public'
  AND indexname NOT LIKE '%_pkey';
```

#### 4. N+1ã‚¯ã‚¨ãƒªå•é¡Œã®è§£æ¶ˆ

```typescript
// backend/src/cats/cats.service.ts

// âŒ N+1å•é¡Œã®ã‚ã‚‹å®Ÿè£…
async findAllBad() {
  const cats = await this.prisma.cat.findMany();
  
  // å„çŒ«ã”ã¨ã«breedã‚’å–å¾—ï¼ˆN+1ï¼‰
  for (const cat of cats) {
    cat.breed = await this.prisma.breed.findUnique({
      where: { id: cat.breedId }
    });
  }
  
  return cats;
}

// âœ… æœ€é©åŒ–ã•ã‚ŒãŸå®Ÿè£…
async findAll(query: FindCatsDto) {
  return this.prisma.cat.findMany({
    where: {
      deletedAt: null,
      ...(query.name && { name: { contains: query.name } }),
      ...(query.breedId && { breedId: query.breedId }),
    },
    include: {
      breed: true,        // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€åº¦ã«å–å¾—
      coatColor: true,
      tags: true,
    },
    orderBy: {
      [query.sortBy || 'createdAt']: query.order || 'desc',
    },
    take: query.limit || 20,
    skip: (query.page - 1) * (query.limit || 20),
  });
}

// ã•ã‚‰ã«æœ€é©åŒ–: select ã§å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿å–å¾—
async findAllOptimized(query: FindCatsDto) {
  return this.prisma.cat.findMany({
    where: { /* ... */ },
    select: {
      id: true,
      name: true,
      birthDate: true,
      breed: {
        select: {
          id: true,
          name: true,
        },
      },
      coatColor: {
        select: {
          id: true,
          name: true,
        },
      },
    },
  });
}
```

**å®Œäº†åŸºæº–:**
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒã¸ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã¨é©ç”¨
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç¢ºèª
- [ ] N+1ã‚¯ã‚¨ãƒªå•é¡Œã®è§£æ¶ˆ
- [ ] ã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®å®Ÿæ–½
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

---

## ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ”¹å–„

### H3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®‰å…¨æ€§å¼·åŒ–

**ç›®çš„:** TypeScriptã®å‹å®‰å…¨æ€§ã‚’æœ€å¤§é™æ´»ç”¨ã—ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’å‰Šæ¸›

**å®Ÿè£…æ‰‹é †:**

#### 1. ESLintè¨­å®šã®å³æ ¼åŒ–

```javascript
// frontend/eslint.config.mjs
export default [
  {
    name: 'frontend-typescript-strict',
    files: ["**/*.ts", "**/*.tsx"],
    rules: {
      // æ®µéšçš„ã«å³æ ¼åŒ–
      '@typescript-eslint/no-explicit-any': 'error', // anyã‚’ç¦æ­¢
      '@typescript-eslint/no-unsafe-assignment': 'error',
      '@typescript-eslint/no-unsafe-member-access': 'error',
      '@typescript-eslint/no-unsafe-call': 'error',
      '@typescript-eslint/no-unsafe-return': 'error',
      
      // å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶é™
      '@typescript-eslint/consistent-type-assertions': [
        'error',
        { assertionStyle: 'as', objectLiteralTypeAssertions: 'never' }
      ],
      
      // null/undefined ãƒã‚§ãƒƒã‚¯
      '@typescript-eslint/no-non-null-assertion': 'error',
      '@typescript-eslint/strict-boolean-expressions': 'warn',
    }
  },
];
```

#### 2. Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹å‹ç”Ÿæˆ

```typescript
// frontend/src/lib/schemas/cat.schema.ts
import { z } from 'zod';

export const catSchema = z.object({
  id: z.string().uuid(),
  name: z.string().min(1, 'åå‰ã¯å¿…é ˆã§ã™').max(100),
  birthDate: z.coerce.date(),
  gender: z.enum(['MALE', 'FEMALE']),
  breedId: z.string().uuid(),
  coatColorId: z.string().uuid(),
  microchipId: z.string().optional(),
  notes: z.string().optional(),
});

export const createCatSchema = catSchema.omit({ id: true });
export const updateCatSchema = catSchema.partial().required({ id: true });

export type Cat = z.infer<typeof catSchema>;
export type CreateCatInput = z.infer<typeof createCatSchema>;
export type UpdateCatInput = z.infer<typeof updateCatSchema>;

// ãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ã‚¹ã‚­ãƒ¼ãƒï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãï¼‰
export const catFormSchema = z.object({
  name: z
    .string()
    .min(1, 'åå‰ã¯å¿…é ˆã§ã™')
    .max(100, 'åå‰ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  birthDate: z
    .date({ required_error: 'èª•ç”Ÿæ—¥ã¯å¿…é ˆã§ã™' })
    .max(new Date(), 'æœªæ¥ã®æ—¥ä»˜ã¯é¸æŠã§ãã¾ã›ã‚“'),
  gender: z
    .enum(['MALE', 'FEMALE'], { required_error: 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„' }),
  breedId: z
    .string({ required_error: 'å“ç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„' })
    .uuid('ç„¡åŠ¹ãªå“ç¨®IDã§ã™'),
  coatColorId: z
    .string({ required_error: 'æ¯›è‰²ã‚’é¸æŠã—ã¦ãã ã•ã„' })
    .uuid('ç„¡åŠ¹ãªæ¯›è‰²IDã§ã™'),
  microchipId: z
    .string()
    .optional()
    .refine(
      (val) => !val || /^[0-9]{15}$/.test(val),
      'ãƒã‚¤ã‚¯ãƒ­ãƒãƒƒãƒ—IDã¯15æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„'
    ),
  notes: z.string().max(1000, 'ãƒ¡ãƒ¢ã¯1000æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„').optional(),
});

export type CatFormData = z.infer<typeof catFormSchema>;
```

#### 3. React Hook Form + Zod ã®çµ±åˆ

```typescript
// frontend/src/app/cats/components/CatForm.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { catFormSchema, type CatFormData } from '@/lib/schemas/cat.schema';

export function CatForm({ onSubmit, defaultValues }: CatFormProps) {
  const form = useForm<CatFormData>({
    resolver: zodResolver(catFormSchema),
    defaultValues,
  });
  
  const handleSubmit = form.handleSubmit(async (data) => {
    try {
      await onSubmit(data);
      form.reset();
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    }
  });
  
  return (
    <form onSubmit={handleSubmit}>
      <TextInput
        {...form.register('name')}
        label="åå‰"
        error={form.formState.errors.name?.message}
        required
      />
      
      <DateInput
        {...form.register('birthDate')}
        label="èª•ç”Ÿæ—¥"
        error={form.formState.errors.birthDate?.message}
        required
      />
      
      {/* ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
      
      <Button type="submit" loading={form.formState.isSubmitting}>
        ç™»éŒ²
      </Button>
    </form>
  );
}
```

#### 4. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å‹å®‰å…¨åŒ–

```typescript
// frontend/src/lib/api/typed-client.ts
import type { paths } from './generated/schema';

type ExtractResponse<T> = T extends { 200: { content: { 'application/json': infer R } } }
  ? R
  : never;

type ApiEndpoint = keyof paths;
type ApiMethod<E extends ApiEndpoint> = keyof paths[E];
type ApiResponse<E extends ApiEndpoint, M extends ApiMethod<E>> = 
  ExtractResponse<paths[E][M]['responses']>;

// å‹å®‰å…¨ãªAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
export async function typedGet<E extends ApiEndpoint>(
  endpoint: E
): Promise<ApiResponse<E, 'get'>> {
  const response = await fetch(`${API_BASE_URL}${endpoint}`);
  if (!response.ok) {
    throw new ApiError(response.statusText, response.status);
  }
  return response.json();
}

// ä½¿ç”¨ä¾‹
const cats = await typedGet('/api/v1/cats'); // å‹æ¨è«–ãŒåŠ¹ã
```

**å®Œäº†åŸºæº–:**
- [ ] ESLintè¨­å®šã®å³æ ¼åŒ–
- [ ] Zodã‚¹ã‚­ãƒ¼ãƒã®å…¨ãƒ¢ãƒ‡ãƒ«å®šç¾©
- [ ] React Hook Form + Zod ã®çµ±åˆ
- [ ] æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- [ ] å‹ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [ ] ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

---

### M1: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„

**ç›®çš„:** WCAG 2.1 ãƒ¬ãƒ™ãƒ«AAæº–æ‹ 

**å®Ÿè£…æ‰‹é †:**

#### 1. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTMLã®ä½¿ç”¨

```tsx
// âŒ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®ä½ã„å®Ÿè£…
<div onClick={handleClick}>ã‚¯ãƒªãƒƒã‚¯</div>

// âœ… ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªãƒœã‚¿ãƒ³è¦ç´ 
<button onClick={handleClick}>ã‚¯ãƒªãƒƒã‚¯</button>

// âŒ éã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªãƒªã‚¹ãƒˆ
<div>
  {items.map(item => <div>{item.name}</div>)}
</div>

// âœ… ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãªãƒªã‚¹ãƒˆ
<ul role="list">
  {items.map(item => (
    <li key={item.id}>{item.name}</li>
  ))}
</ul>
```

#### 2. ARIAãƒ©ãƒ™ãƒ«ã®è¿½åŠ 

```tsx
// frontend/src/components/cats/CatCard.tsx
export function CatCard({ cat, onEdit, onDelete }: CatCardProps) {
  return (
    <article aria-labelledby={`cat-name-${cat.id}`}>
      <h3 id={`cat-name-${cat.id}`}>{cat.name}</h3>
      
      <button
        onClick={() => onEdit(cat)}
        aria-label={`${cat.name}ã‚’ç·¨é›†`}
      >
        <IconEdit size={16} aria-hidden="true" />
        ç·¨é›†
      </button>
      
      <button
        onClick={() => onDelete(cat)}
        aria-label={`${cat.name}ã‚’å‰Šé™¤`}
      >
        <IconTrash size={16} aria-hidden="true" />
        å‰Šé™¤
      </button>
    </article>
  );
}
```

#### 3. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

```tsx
// frontend/src/components/common/Modal.tsx
import { useFocusTrap, useHotkeys } from '@mantine/hooks';

export function Modal({ isOpen, onClose, children }: ModalProps) {
  const focusTrapRef = useFocusTrap(isOpen);
  
  // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
  useHotkeys([['Escape', onClose]]);
  
  if (!isOpen) return null;
  
  return (
    <div
      role="dialog"
      aria-modal="true"
      aria-labelledby="modal-title"
      ref={focusTrapRef}
    >
      <div className="modal-content">
        {children}
      </div>
    </div>
  );
}
```

#### 4. ã‚«ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ”¹å–„

```typescript
// frontend/src/styles/accessibility.ts
export const a11yColors = {
  // WCAG AAæº–æ‹ : æœ€å°ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯” 4.5:1
  text: {
    primary: '#1a1a1a',      // èƒŒæ™¯: #ffffff, ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ: 17.9:1
    secondary: '#4a4a4a',    // èƒŒæ™¯: #ffffff, ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ: 10.2:1
    disabled: '#9e9e9e',     // èƒŒæ™¯: #ffffff, ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ: 4.6:1
  },
  background: {
    primary: '#ffffff',
    secondary: '#f5f5f5',
    hover: '#e0e0e0',
  },
  error: {
    main: '#d32f2f',         // ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ: 5.0:1
    background: '#ffebee',
  },
  success: {
    main: '#2e7d32',         // ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ: 5.9:1
    background: '#e8f5e9',
  },
};
```

#### 5. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

```typescript
// frontend/src/__tests__/accessibility/cat-form.test.tsx
import { render, screen } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { CatForm } from '@/app/cats/components/CatForm';

expect.extend(toHaveNoViolations);

describe('CatForm Accessibility', () => {
  it('should have no accessibility violations', async () => {
    const { container } = render(<CatForm onSubmit={jest.fn()} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
  
  it('should be keyboard navigable', () => {
    render(<CatForm onSubmit={jest.fn()} />);
    
    const nameInput = screen.getByLabelText('åå‰');
    nameInput.focus();
    expect(document.activeElement).toBe(nameInput);
    
    // Tab ã‚­ãƒ¼ã§æ¬¡ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç§»å‹•
    userEvent.tab();
    expect(document.activeElement).toBe(screen.getByLabelText('èª•ç”Ÿæ—¥'));
  });
});
```

**å®Œäº†åŸºæº–:**
- [ ] ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTML ã¸ã®å¤‰æ›
- [ ] ARIAãƒ©ãƒ™ãƒ«ã®å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ 
- [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] ã‚«ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ”¹å–„
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] axe-core ã«ã‚ˆã‚‹è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ãƒ†ã‚¹ãƒˆ

---

## ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### M2: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

**ç›®çš„:** ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ 70%ä»¥ä¸Šã®é”æˆ

**å®Ÿè£…æ‰‹é †:**

#### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
// backend/src/cats/cats.service.spec.ts
import { Test, TestingModule } from '@nestjs/testing';
import { CatsService } from './cats.service';
import { PrismaService } from '../prisma/prisma.service';

describe('CatsService', () => {
  let service: CatsService;
  let prisma: PrismaService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        CatsService,
        {
          provide: PrismaService,
          useValue: {
            cat: {
              create: jest.fn(),
              findMany: jest.fn(),
              findUnique: jest.fn(),
              update: jest.fn(),
              delete: jest.fn(),
            },
          },
        },
      ],
    }).compile();

    service = module.get<CatsService>(CatsService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  describe('create', () => {
    it('should create a new cat', async () => {
      const mockCat = {
        id: '1',
        name: 'Fluffy',
        birthDate: new Date(),
        breedId: 'breed-1',
      };

      jest.spyOn(prisma.cat, 'create').mockResolvedValue(mockCat as any);

      const result = await service.create({
        name: 'Fluffy',
        birthDate: new Date(),
        breedId: 'breed-1',
      });

      expect(result).toEqual(mockCat);
      expect(prisma.cat.create).toHaveBeenCalledTimes(1);
    });

    it('should throw error if breed does not exist', async () => {
      jest.spyOn(prisma.cat, 'create').mockRejectedValue(
        new Error('Foreign key constraint failed')
      );

      await expect(
        service.create({
          name: 'Fluffy',
          birthDate: new Date(),
          breedId: 'invalid-breed',
        })
      ).rejects.toThrow();
    });
  });

  describe('findAll', () => {
    it('should return paginated cats', async () => {
      const mockCats = [
        { id: '1', name: 'Cat 1' },
        { id: '2', name: 'Cat 2' },
      ];

      jest.spyOn(prisma.cat, 'findMany').mockResolvedValue(mockCats as any);

      const result = await service.findAll({ page: 1, limit: 20 });

      expect(result).toEqual(mockCats);
      expect(prisma.cat.findMany).toHaveBeenCalledWith(
        expect.objectContaining({
          take: 20,
          skip: 0,
        })
      );
    });
  });
});
```

#### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

```tsx
// frontend/src/app/cats/components/CatForm.test.tsx
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { CatForm } from './CatForm';

describe('CatForm', () => {
  const mockOnSubmit = jest.fn();

  beforeEach(() => {
    mockOnSubmit.mockClear();
  });

  it('should render all form fields', () => {
    render(<CatForm onSubmit={mockOnSubmit} />);

    expect(screen.getByLabelText('åå‰')).toBeInTheDocument();
    expect(screen.getByLabelText('èª•ç”Ÿæ—¥')).toBeInTheDocument();
    expect(screen.getByLabelText('æ€§åˆ¥')).toBeInTheDocument();
    expect(screen.getByLabelText('å“ç¨®')).toBeInTheDocument();
  });

  it('should show validation errors for empty fields', async () => {
    render(<CatForm onSubmit={mockOnSubmit} />);

    const submitButton = screen.getByRole('button', { name: 'ç™»éŒ²' });
    await userEvent.click(submitButton);

    await waitFor(() => {
      expect(screen.getByText('åå‰ã¯å¿…é ˆã§ã™')).toBeInTheDocument();
      expect(screen.getByText('èª•ç”Ÿæ—¥ã¯å¿…é ˆã§ã™')).toBeInTheDocument();
    });

    expect(mockOnSubmit).not.toHaveBeenCalled();
  });

  it('should submit form with valid data', async () => {
    render(<CatForm onSubmit={mockOnSubmit} />);

    await userEvent.type(screen.getByLabelText('åå‰'), 'Fluffy');
    await userEvent.type(screen.getByLabelText('èª•ç”Ÿæ—¥'), '2024-01-01');
    await userEvent.click(screen.getByLabelText('ã‚ªã‚¹'));
    await userEvent.selectOptions(screen.getByLabelText('å“ç¨®'), 'breed-1');

    await userEvent.click(screen.getByRole('button', { name: 'ç™»éŒ²' }));

    await waitFor(() => {
      expect(mockOnSubmit).toHaveBeenCalledWith({
        name: 'Fluffy',
        birthDate: expect.any(Date),
        gender: 'MALE',
        breedId: 'breed-1',
      });
    });
  });
});
```

#### 3. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š

```json
// backend/package.json
{
  "jest": {
    "coverageThreshold": {
      "global": {
        "branches": 70,
        "functions": 70,
        "lines": 70,
        "statements": 70
      }
    },
    "collectCoverageFrom": [
      "src/**/*.ts",
      "!src/**/*.spec.ts",
      "!src/**/*.e2e-spec.ts",
      "!src/main.ts",
      "!src/scripts/**"
    ]
  }
}
```

```json
// frontend/package.json
{
  "jest": {
    "coverageThreshold": {
      "global": {
        "branches": 70,
        "functions": 70,
        "lines": 70,
        "statements": 70
      }
    },
    "collectCoverageFrom": [
      "src/**/*.{ts,tsx}",
      "!src/**/*.test.{ts,tsx}",
      "!src/**/*.stories.{ts,tsx}",
      "!src/app/layout.tsx",
      "!src/app/**/page.tsx"
    ]
  }
}
```

**å®Œäº†åŸºæº–:**
- [ ] ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ 70%ä»¥ä¸Šï¼‰
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ 70%ä»¥ä¸Šï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã®è¿½åŠ 
- [ ] ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯è¿½åŠ 

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ ] C1: CSRFä¿è­·ã®å®Ÿè£…
- [ ] C2: ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç†
- [ ] H1: APIãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å¼·åŒ–
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®å¼·åŒ–
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã®çŸ­ç¸®

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

- [ ] H2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–
- [ ] N+1ã‚¯ã‚¨ãƒªå•é¡Œã®è§£æ¶ˆ
- [ ] ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã®å®Ÿè£…
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ã®æ–‡æ›¸åŒ–

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- [ ] H3: å‹å®‰å…¨æ€§å¼·åŒ–ï¼ˆESLintå³æ ¼åŒ–ï¼‰
- [ ] Zodã‚¹ã‚­ãƒ¼ãƒã®å®Ÿè£…
- [ ] React Hook Form + Zod çµ±åˆ
- [ ] M1: ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆç”»åƒã€ã‚³ãƒ¼ãƒ‰åˆ†å‰²ï¼‰

### ãƒ†ã‚¹ãƒˆ

- [ ] M2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- [ ] E2Eãƒ†ã‚¹ãƒˆã®æ‹¡å……
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸70%é”æˆ

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ ] L1: APIä½¿ç”¨ä¾‹ã®è¿½åŠ 
- [ ] TSDoc/JSDocã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 
- [ ] CHANGELOG.mdã®ä½œæˆ
- [ ] ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã®æ›´æ–°

---

## é€²æ—è¿½è·¡

### Week 1-2: CRITICAL Items

| æ—¥ä»˜ | ã‚¿ã‚¹ã‚¯ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¡ãƒ¢ |
|------|--------|-----------|------|
| 2025-11-11 | C1é–‹å§‹ | â³ æœªç€æ‰‹ | |
| | C2é–‹å§‹ | â³ æœªç€æ‰‹ | |
| | H1é–‹å§‹ | â³ æœªç€æ‰‹ | |

### Week 3-4: HIGH Items

| æ—¥ä»˜ | ã‚¿ã‚¹ã‚¯ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¡ãƒ¢ |
|------|--------|-----------|------|
| | H2é–‹å§‹ | â³ æœªç€æ‰‹ | |
| | H3é–‹å§‹ | â³ æœªç€æ‰‹ | |

### Week 5-8: MEDIUM Items

| æ—¥ä»˜ | ã‚¿ã‚¹ã‚¯ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¡ãƒ¢ |
|------|--------|-----------|------|
| | M1é–‹å§‹ | â³ æœªç€æ‰‹ | |
| | M2é–‹å§‹ | â³ æœªç€æ‰‹ | |
| | M3é–‹å§‹ | â³ æœªç€æ‰‹ | |

---

**Document Version:** 1.0  
**Last Updated:** 2025-11-11  
**Status:** In Progress
